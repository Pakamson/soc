<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bulk Import - SOC Inventory</title>
    <style>
      body { font-family: Arial, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 20px; }
      .nav-links {
        margin-bottom: 20px;
      }
      .nav-links a {
        margin-right: 15px;
        color: #0066cc;
        text-decoration: none;
      }
      .nav-links a:hover {
        text-decoration: underline;
      }
      .import-section {
        background: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .instructions {
        background: #f8f9fa;
        border-left: 4px solid #6610f2;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 4px 4px 0;
      }
      .instructions h3 {
        margin-top: 0;
        color: #6610f2;
      }
      .instructions ul {
        margin: 10px 0;
        padding-left: 20px;
      }
      .instructions li {
        margin: 5px 0;
      }
      .import-form {
        margin-top: 20px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 4px;
        border: 1px solid #dee2e6;
      }
      .import-form form {
        display: flex;
        gap: 15px;
        align-items: center;
      }
      .import-submit-btn {
        background: #0066cc;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .cancel-btn {
        background: #dc3545;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      #importStatus {
        margin-top: 15px;
        padding: 12px;
        border-radius: 4px;
        display: none;
      }
      #importStatus.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      #importStatus.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .sample-template {
        margin-top: 30px;
      }
      .sample-template pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        border: 1px solid #dee2e6;
      }
    </style>
  </head>
  <body>
    <div class="nav-links">
      <a href="/">Add New Item</a>
      <a href="/search">Quick Search</a>
      <a href="/advanced-search">Advanced Search</a>
      <a href="/bulk-import">Bulk Import</a>
    </div>

    <h1>Bulk Import Items</h1>

    <div class="import-section">
      <div class="instructions">
        <h3>Instructions</h3>
        <ul>
          <li>Prepare your CSV file with the following columns (headers are case-insensitive):
            <ul>
              <li>record_date (YYYY-MM-DD)</li>
              <li>label</li>
              <li>type</li>
              <li>brand</li>
              <li>model_no</li>
              <li>serial_no</li>
              <li>location</li>
              <li>location_2</li>
              <li>invoice_no</li>
              <li>purchase_date (YYYY-MM-DD)</li>
              <li>price (decimal)</li>
              <li>maintenance_end_date (YYYY-MM-DD)</li>
              <li>status</li>
            </ul>
          </li>
          <li>Dates should be in YYYY-MM-DD format</li>
          <li>Price should be a decimal number with up to 2 decimal places</li>
          <li>Empty values are allowed and will be treated as null</li>
        </ul>
      </div>

      <div class="import-form">
        <form onsubmit="importCSV(event)">
          <input type="file" id="csvFile" accept=".csv" required>
          <button type="submit" class="import-submit-btn">Upload and Import</button>
        </form>
        <div id="importStatus"></div>
      </div>

      <div class="sample-template">
        <h3>Sample CSV Template</h3>
  <pre>record_date,label,type,brand,model_no,serial_no,location,location_2,invoice_no,purchase_date,price,maintenance_end_date,status
2025-10-23,Asset001,Desktop,Dell,OptiPlex 7090,SN123456,Main Office,Floor 1,INV001,2025-10-01,1200.00,2026-10-01,Active
2025-10-23,Asset002,Laptop,Lenovo,ThinkPad X1,SN789012,Branch Office,Floor 2,INV002,2025-09-15,1500.00,2026-09-15,Active</pre>
      </div>
    </div>

    <script>
      async function importCSV(event) {
        event.preventDefault()
        const fileInput = document.getElementById('csvFile')
        const statusDiv = document.getElementById('importStatus')
        const file = fileInput.files[0]
        
        if (!file) {
          alert('Please select a CSV file to import')
          return
        }

        const formData = new FormData()
        formData.append('file', file)

        statusDiv.className = ''
        statusDiv.style.display = 'block'
        statusDiv.textContent = 'Importing...'

        try {
          const response = await fetch('/api/items/import-csv', {
            method: 'POST',
            body: formData
          })

          const result = await response.json()

          if (response.ok) {
            statusDiv.className = 'success'
            statusDiv.textContent = `Successfully imported ${result.imported} items`
            // Clear the file input
            fileInput.value = ''
          } else {
            statusDiv.className = 'error'
            statusDiv.textContent = result.error || 'Failed to import CSV file'
          }
        } catch (err) {
          statusDiv.className = 'error'
          statusDiv.textContent = 'Network error: ' + err.message
        }
      }
    </script>
  </body>
</html>